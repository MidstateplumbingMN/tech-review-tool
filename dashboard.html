<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Dashboard - Mid-State Plumbing</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div id="root"></div>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const Dashboard = () => {
            const [savedReviews, setSavedReviews] = useState([]);
            const [timePeriod, setTimePeriod] = useState('30');
            const [technicianGoals, setTechnicianGoals] = useState({});
            const [showGoalsModal, setShowGoalsModal] = useState(false);
            const [currentGoalTech, setCurrentGoalTech] = useState('');
            const [currentView, setCurrentView] = useState('dashboard'); // 'dashboard', 'goals', 'leaderboard', 'comparison'
            const [comparisonTech, setComparisonTech] = useState('');
            const [comparisonPeriod, setComparisonPeriod] = useState('last3');
            const [leaderboardPeriod, setLeaderboardPeriod] = useState('30');
            const [showAnonymous, setShowAnonymous] = useState(false);
            
            // Company data
            const departments = ['Plumbing', 'HVAC', 'Drains'];
            const technicians = [
                { name: 'Mark Daniels', dept: 'Plumbing' },
                { name: 'Gordy Radant', dept: 'Plumbing' },
                { name: 'Jon Glenn', dept: 'Plumbing/Drains' },
                { name: 'Lukas Schlosser', dept: 'HVAC' },
                { name: 'Gannon Blasier', dept: 'HVAC' },
                { name: 'Doug McNamara', dept: 'HVAC' }
            ];
            
            // Load data from localStorage
            useEffect(() => {
                const loadData = () => {
                    const reviews = localStorage.getItem('savedReviews');
                    if (reviews) {
                        setSavedReviews(JSON.parse(reviews));
                    }
                    
                    const goals = localStorage.getItem('technicianGoals');
                    if (goals) {
                        setTechnicianGoals(JSON.parse(goals));
                    }
                };
                
                loadData();
                
                // Refresh every 5 seconds to catch new reviews
                const interval = setInterval(loadData, 5000);
                return () => clearInterval(interval);
            }, []);
            
            const getDepartmentForTech = (techName) => {
                const tech = technicians.find(t => t.name === techName);
                return tech ? tech.dept : 'Unknown';
            };
            
            const filterReviewsByPeriod = (reviews, period) => {
                if (period === 'all') return reviews;
                
                const now = new Date();
                const daysAgo = parseInt(period);
                const cutoff = new Date(now.getTime() - (daysAgo * 24 * 60 * 60 * 1000));
                
                return reviews.filter(review => {
                    const reviewDate = new Date(review.reviewDate);
                    return reviewDate >= cutoff;
                });
            };
            
            const calculateDashboardStats = (period) => {
                const filtered = filterReviewsByPeriod(savedReviews, period);
                
                const totalRideAlongs = filtered.length;
                const totalCalls = filtered.reduce((sum, review) => sum + (review.calls?.length || 0), 0);
                
                // Department scores
                const deptScores = {};
                departments.forEach(dept => {
                    const deptReviews = filtered.filter(r => getDepartmentForTech(r.technicianName) === dept);
                    const allScores = deptReviews.flatMap(r => 
                        (r.calls || []).flatMap(call => 
                            [call.prepare, call.greet, call.explore, call.present, call.execute, call.wrapUp]
                        )
                    ).filter(s => s !== 'N/A' && s !== 0);
                    
                    deptScores[dept] = allScores.length > 0 
                        ? (allScores.reduce((a, b) => a + b, 0) / allScores.length).toFixed(2)
                        : 0;
                });
                
                // Top performers
                const techScores = {};
                filtered.forEach(review => {
                    if (!techScores[review.technicianName]) {
                        techScores[review.technicianName] = [];
                    }
                    (review.calls || []).forEach(call => {
                        const scores = [call.prepare, call.greet, call.explore, call.present, call.execute, call.wrapUp]
                            .filter(s => s !== 'N/A' && s !== 0);
                        if (scores.length > 0) {
                            techScores[review.technicianName].push(...scores);
                        }
                    });
                });
                
                const avgScores = Object.entries(techScores).map(([name, scores]) => ({
                    name,
                    avg: scores.length > 0 ? (scores.reduce((a, b) => a + b, 0) / scores.length).toFixed(2) : 0
                })).sort((a, b) => b.avg - a.avg);
                
                // Development areas
                const stepScores = {
                    prepare: [], greet: [], explore: [], present: [], execute: [], wrapUp: []
                };
                
                filtered.forEach(review => {
                    (review.calls || []).forEach(call => {
                        Object.keys(stepScores).forEach(step => {
                            if (call[step] !== 'N/A' && call[step] !== 0) {
                                stepScores[step].push(call[step]);
                            }
                        });
                    });
                });
                
                const avgByStep = Object.entries(stepScores).map(([step, scores]) => ({
                    step: step.charAt(0).toUpperCase() + step.slice(1),
                    avg: scores.length > 0 ? (scores.reduce((a, b) => a + b, 0) / scores.length).toFixed(2) : 0
                })).sort((a, b) => a.avg - b.avg);
                
                return {
                    totalRideAlongs,
                    totalCalls,
                    deptScores,
                    topPerformers: avgScores.slice(0, 3),
                    developmentAreas: avgByStep.slice(0, 3),
                    allTechScores: avgScores
                };
            };
            
            const getComparisonData = (techName, period) => {
                let techReviews = savedReviews.filter(r => r.technicianName === techName);
                techReviews.sort((a, b) => new Date(a.reviewDate) - new Date(b.reviewDate));
                
                if (period === 'last3') {
                    techReviews = techReviews.slice(-3);
                } else if (period !== 'all') {
                    techReviews = filterReviewsByPeriod(techReviews, period);
                }
                
                return techReviews.map(review => {
                    const allScores = (review.calls || []).flatMap(call => 
                        [call.prepare, call.greet, call.explore, call.present, call.execute, call.wrapUp]
                    ).filter(s => s !== 'N/A' && s !== 0);
                    
                    const avg = allScores.length > 0 
                        ? (allScores.reduce((a, b) => a + b, 0) / allScores.length).toFixed(2)
                        : 0;
                    
                    const stepAvgs = {};
                    ['prepare', 'greet', 'explore', 'present', 'execute', 'wrapUp'].forEach(step => {
                        const stepScores = (review.calls || [])
                            .map(call => call[step])
                            .filter(s => s !== 'N/A' && s !== 0);
                        stepAvgs[step] = stepScores.length > 0 
                            ? (stepScores.reduce((a, b) => a + b, 0) / stepScores.length).toFixed(2)
                            : 0;
                    });
                    
                    return {
                        date: review.reviewDate,
                        avg: parseFloat(avg),
                        ...stepAvgs,
                        calls: review.calls?.length || 0
                    };
                });
            };
            
            const getLeaderboardData = (period, anonymous = false) => {
                const filtered = filterReviewsByPeriod(savedReviews, period);
                
                const techScores = {};
                filtered.forEach(review => {
                    if (!techScores[review.technicianName]) {
                        techScores[review.technicianName] = {
                            name: review.technicianName,
                            dept: getDepartmentForTech(review.technicianName),
                            scores: [],
                            rideAlongs: 0,
                            totalCalls: 0
                        };
                    }
                    
                    techScores[review.technicianName].rideAlongs++;
                    techScores[review.technicianName].totalCalls += review.calls?.length || 0;
                    
                    (review.calls || []).forEach(call => {
                        const callScores = [call.prepare, call.greet, call.explore, call.present, call.execute, call.wrapUp]
                            .filter(s => s !== 'N/A' && s !== 0);
                        techScores[review.technicianName].scores.push(...callScores);
                    });
                });
                
                const leaderboard = Object.values(techScores)
                    .map((tech, index) => ({
                        ...tech,
                        avg: tech.scores.length > 0 
                            ? (tech.scores.reduce((a, b) => a + b, 0) / tech.scores.length).toFixed(2)
                            : 0,
                        displayName: anonymous ? `Tech ${index + 1}` : tech.name
                    }))
                    .sort((a, b) => b.avg - a.avg)
                    .map((tech, index) => ({
                        ...tech,
                        rank: index + 1
                    }));
                
                return leaderboard;
            };
            
            const stats = calculateDashboardStats(timePeriod);
            
            return (
                <div className="min-h-screen p-4 md:p-8">
                    <div className="max-w-7xl mx-auto">
                        {/* Header */}
                        <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                            <div className="flex justify-between items-center mb-4">
                                <h1 className="text-3xl font-bold text-gray-800">Mid-State Performance Dashboard</h1>
                                <a 
                                    href="index.html" 
                                    className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md font-medium"
                                >
                                    ‚Üê Back to Reviews
                                </a>
                            </div>
                            
                            {/* Navigation */}
                            <div className="flex gap-2 border-b border-gray-200">
                                <button
                                    onClick={() => setCurrentView('dashboard')}
                                    className={`px-4 py-2 font-medium border-b-2 ${
                                        currentView === 'dashboard' 
                                            ? 'border-blue-600 text-blue-600' 
                                            : 'border-transparent text-gray-600'
                                    }`}
                                >
                                    üìä Dashboard
                                </button>
                                <button
                                    onClick={() => setCurrentView('comparison')}
                                    className={`px-4 py-2 font-medium border-b-2 ${
                                        currentView === 'comparison' 
                                            ? 'border-blue-600 text-blue-600' 
                                            : 'border-transparent text-gray-600'
                                    }`}
                                >
                                    üìà Comparison
                                </button>
                                <button
                                    onClick={() => setCurrentView('leaderboard')}
                                    className={`px-4 py-2 font-medium border-b-2 ${
                                        currentView === 'leaderboard' 
                                            ? 'border-blue-600 text-blue-600' 
                                            : 'border-transparent text-gray-600'
                                    }`}
                                >
                                    üèÜ Leaderboard
                                </button>
                                <button
                                    onClick={() => setCurrentView('goals')}
                                    className={`px-4 py-2 font-medium border-b-2 ${
                                        currentView === 'goals' 
                                            ? 'border-blue-600 text-blue-600' 
                                            : 'border-transparent text-gray-600'
                                    }`}
                                >
                                    üéØ Goals
                                </button>
                            </div>
                        </div>
                        
                        {/* Dashboard View */}
                        {currentView === 'dashboard' && (
                            <div className="space-y-6">
                                {/* Time Period Selector */}
                                <div className="bg-white rounded-lg shadow-md p-6">
                                    <div className="flex justify-between items-center">
                                        <h2 className="text-2xl font-bold text-gray-800">Performance Overview</h2>
                                        <select
                                            value={timePeriod}
                                            onChange={(e) => setTimePeriod(e.target.value)}
                                            className="px-4 py-2 border border-gray-300 rounded-md"
                                        >
                                            <option value="30">Last 30 Days</option>
                                            <option value="90">Last 90 Days</option>
                                            <option value="all">All Time</option>
                                        </select>
                                    </div>
                                </div>
                                
                                {/* Key Metrics */}
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div className="bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg shadow-md p-6 text-white">
                                        <div className="text-sm opacity-90 mb-2">Total Ride-Alongs</div>
                                        <div className="text-4xl font-bold">{stats.totalRideAlongs}</div>
                                    </div>
                                    
                                    <div className="bg-gradient-to-br from-green-500 to-green-600 rounded-lg shadow-md p-6 text-white">
                                        <div className="text-sm opacity-90 mb-2">Total Calls Observed</div>
                                        <div className="text-4xl font-bold">{stats.totalCalls}</div>
                                    </div>
                                    
                                    <div className="bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg shadow-md p-6 text-white">
                                        <div className="text-sm opacity-90 mb-2">Avg Calls per Ride-Along</div>
                                        <div className="text-4xl font-bold">
                                            {stats.totalRideAlongs > 0 ? (stats.totalCalls / stats.totalRideAlongs).toFixed(1) : 0}
                                        </div>
                                    </div>
                                </div>
                                
                                {/* Department Performance */}
                                <div className="bg-white rounded-lg shadow-md p-6">
                                    <h3 className="text-xl font-bold text-gray-800 mb-4">Department Performance</h3>
                                    <div className="space-y-4">
                                        {departments.map(dept => (
                                            <div key={dept}>
                                                <div className="flex justify-between items-center mb-2">
                                                    <span className="font-medium text-gray-700">{dept}</span>
                                                    <span className="text-2xl font-bold text-blue-600">
                                                        {stats.deptScores[dept] || '0.00'}/5.0
                                                    </span>
                                                </div>
                                                <div className="w-full bg-gray-200 rounded-full h-3">
                                                    <div 
                                                        className="bg-blue-600 h-3 rounded-full transition-all"
                                                        style={{width: `${((stats.deptScores[dept] || 0) / 5) * 100}%`}}
                                                    ></div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                
                                {/* Top Performers */}
                                <div className="bg-white rounded-lg shadow-md p-6">
                                    <h3 className="text-xl font-bold text-gray-800 mb-4">üèÜ Top Performers</h3>
                                    {stats.topPerformers.length > 0 ? (
                                        <div className="space-y-3">
                                            {stats.topPerformers.map((tech, index) => (
                                                <div key={tech.name} className="flex items-center justify-between p-3 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-lg">
                                                    <div className="flex items-center gap-3">
                                                        <span className="text-2xl">
                                                            {index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : 'ü•â'}
                                                        </span>
                                                        <div>
                                                            <div className="font-semibold text-gray-800">{tech.name}</div>
                                                            <div className="text-sm text-gray-600">{getDepartmentForTech(tech.name)}</div>
                                                        </div>
                                                    </div>
                                                    <span className="text-2xl font-bold text-blue-600">{tech.avg}/5.0</span>
                                                </div>
                                            ))}
                                        </div>
                                    ) : (
                                        <p className="text-gray-500">No reviews yet</p>
                                    )}
                                </div>
                                
                                {/* Development Areas */}
                                <div className="bg-white rounded-lg shadow-md p-6">
                                    <h3 className="text-xl font-bold text-gray-800 mb-4">üìà Common Growth Opportunities</h3>
                                    {stats.developmentAreas.length > 0 && parseFloat(stats.developmentAreas[0].avg) > 0 ? (
                                        <div className="space-y-3">
                                            {stats.developmentAreas.map((area) => (
                                                <div key={area.step} className="flex items-center justify-between p-3 bg-orange-50 rounded-lg">
                                                    <span className="font-medium text-gray-800">{area.step}</span>
                                                    <span className="text-lg font-semibold text-orange-600">{area.avg}/5.0</span>
                                                </div>
                                            ))}
                                        </div>
                                    ) : (
                                        <p className="text-gray-500">No data yet</p>
                                    )}
                                </div>
                            </div>
                        )}
                        
                        {/* Comparison View */}
                        {currentView === 'comparison' && (
                            <div className="bg-white rounded-lg shadow-md p-6">
                                <h2 className="text-2xl font-bold text-gray-800 mb-6">üìà Performance Comparison</h2>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Technician</label>
                                        <select 
                                            value={comparisonTech} 
                                            onChange={(e) => setComparisonTech(e.target.value)}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md"
                                        >
                                            <option value="">Select...</option>
                                            {technicians.map(t => <option key={t.name} value={t.name}>{t.name}</option>)}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Period</label>
                                        <select 
                                            value={comparisonPeriod} 
                                            onChange={(e) => setComparisonPeriod(e.target.value)}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md"
                                        >
                                            <option value="last3">Last 3 Reviews</option>
                                            <option value="30">Last 30 Days</option>
                                            <option value="90">Last 90 Days</option>
                                            <option value="all">All Time</option>
                                        </select>
                                    </div>
                                </div>
                                
                                {comparisonTech && (() => {
                                    const data = getComparisonData(comparisonTech, comparisonPeriod);
                                    if (data.length === 0) return <p className="text-center py-12 text-gray-500">No reviews found</p>;
                                    
                                    return (
                                        <div className="space-y-6">
                                            <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-6">
                                                <h3 className="font-bold mb-4">Overall Score Trend</h3>
                                                <div className="flex items-end justify-between h-40">
                                                    {data.map((point, i) => (
                                                        <div key={i} className="flex-1 flex flex-col items-center justify-end h-full px-1">
                                                            <div className="text-xs font-bold mb-1">{point.avg}</div>
                                                            <div 
                                                                className="w-full bg-blue-600 rounded-t" 
                                                                style={{height: `${(point.avg/5)*100}%`, minHeight: '20px'}}
                                                            ></div>
                                                            <div className="text-xs mt-2">
                                                                {new Date(point.date).toLocaleDateString('en-US', {month: 'short', day: 'numeric'})}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                            <div className="grid grid-cols-3 gap-4">
                                                <div className="bg-blue-50 rounded-lg p-4 text-center">
                                                    <div className="text-sm text-gray-600 mb-1">Reviews</div>
                                                    <div className="text-2xl font-bold text-blue-600">{data.length}</div>
                                                </div>
                                                <div className="bg-green-50 rounded-lg p-4 text-center">
                                                    <div className="text-sm text-gray-600 mb-1">Total Calls</div>
                                                    <div className="text-2xl font-bold text-green-600">{data.reduce((s, d) => s + d.calls, 0)}</div>
                                                </div>
                                                <div className="bg-purple-50 rounded-lg p-4 text-center">
                                                    <div className="text-sm text-gray-600 mb-1">Progress</div>
                                                    <div className="text-2xl font-bold text-purple-600">
                                                        {((data[data.length-1].avg - data[0].avg) > 0 ? '+' : '')}
                                                        {(data[data.length-1].avg - data[0].avg).toFixed(2)}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })()}
                            </div>
                        )}
                        
                        {/* Leaderboard View */}
                        {currentView === 'leaderboard' && (() => {
                            const leaderboard = getLeaderboardData(leaderboardPeriod, showAnonymous);
                            return (
                                <div className="bg-white rounded-lg shadow-md p-6">
                                    <div className="flex justify-between items-center mb-6">
                                        <h2 className="text-2xl font-bold text-gray-800">üèÜ Team Leaderboard</h2>
                                        <div className="flex gap-3">
                                            <select 
                                                value={leaderboardPeriod} 
                                                onChange={(e) => setLeaderboardPeriod(e.target.value)}
                                                className="px-4 py-2 border border-gray-300 rounded-md"
                                            >
                                                <option value="30">Last 30 Days</option>
                                                <option value="90">Last 90 Days</option>
                                                <option value="all">All Time</option>
                                            </select>
                                            <button
                                                onClick={() => setShowAnonymous(!showAnonymous)}
                                                className={`px-4 py-2 rounded-md font-medium ${
                                                    showAnonymous ? 'bg-gray-600 text-white' : 'bg-gray-200 text-gray-800'
                                                }`}
                                            >
                                                {showAnonymous ? 'üîí Anonymous' : 'üë§ Names'}
                                            </button>
                                            <button 
                                                onClick={() => window.print()}
                                                className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md font-medium"
                                            >
                                                üñ®Ô∏è Print
                                            </button>
                                        </div>
                                    </div>
                                    
                                    {leaderboard.length === 0 ? (
                                        <div className="text-center py-12 text-gray-500">
                                            <div className="text-6xl mb-4">üèÜ</div>
                                            <p className="text-lg">No reviews yet</p>
                                        </div>
                                    ) : (
                                        <div className="space-y-3">
                                            {leaderboard.map((tech, i) => (
                                                <div 
                                                    key={i}
                                                    className={`flex items-center justify-between p-4 rounded-lg ${
                                                        i === 0 ? 'bg-gradient-to-r from-yellow-100 to-yellow-50 border-2 border-yellow-400' :
                                                        i === 1 ? 'bg-gradient-to-r from-gray-100 to-gray-50 border-2 border-gray-400' :
                                                        i === 2 ? 'bg-gradient-to-r from-orange-100 to-orange-50 border-2 border-orange-400' :
                                                        'bg-gray-50 border border-gray-200'
                                                    }`}
                                                >
                                                    <div className="flex items-center gap-4">
                                                        <div className="text-2xl font-bold text-gray-400 w-8">#{tech.rank}</div>
                                                        {i < 3 && (
                                                            <div className="text-3xl">
                                                                {i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : 'ü•â'}
                                                            </div>
                                                        )}
                                                        <div>
                                                            <div className="font-bold text-gray-800 text-lg">{tech.displayName}</div>
                                                            {!showAnonymous && <div className="text-sm text-gray-600">{tech.dept}</div>}
                                                        </div>
                                                    </div>
                                                    <div className="flex items-center gap-6">
                                                        <div className="text-right">
                                                            <div className="text-xs text-gray-600">Ride-Alongs</div>
                                                            <div className="font-semibold text-gray-800">{tech.rideAlongs}</div>
                                                        </div>
                                                        <div className="text-right">
                                                            <div className="text-xs text-gray-600">Calls</div>
                                                            <div className="font-semibold text-gray-800">{tech.totalCalls}</div>
                                                        </div>
                                                        <div className="text-right">
                                                            <div className="text-xs text-gray-600">Avg</div>
                                                            <div className="text-3xl font-bold text-blue-600">{tech.avg}</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            );
                        })()}
                        
                        {/* Goals View */}
                        {currentView === 'goals' && (
                            <div className="bg-white rounded-lg shadow-md p-6">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold text-gray-800">üéØ Goals & Action Plans</h2>
                                    <button
                                        onClick={() => setShowGoalsModal(true)}
                                        className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md font-medium"
                                    >
                                        + Add Goal
                                    </button>
                                </div>
                                
                                {technicians.map(tech => {
                                    const techGoals = technicianGoals[tech.name] || [];
                                    if (techGoals.length === 0) return null;
                                    
                                    return (
                                        <div key={tech.name} className="mb-6">
                                            <h3 className="text-xl font-bold text-gray-800 mb-3">{tech.name} ({tech.dept})</h3>
                                            <div className="space-y-3">
                                                {techGoals.map((goal, index) => (
                                                    <div key={index} className="border rounded-lg p-4 bg-gray-50">
                                                        <div className="flex justify-between items-start">
                                                            <div className="flex-1">
                                                                <div className="flex items-center gap-2 mb-1">
                                                                    <input
                                                                        type="checkbox"
                                                                        checked={goal.completed || false}
                                                                        onChange={() => {
                                                                            const updated = {...technicianGoals};
                                                                            updated[tech.name][index].completed = !goal.completed;
                                                                            setTechnicianGoals(updated);
                                                                            localStorage.setItem('technicianGoals', JSON.stringify(updated));
                                                                        }}
                                                                        className="w-5 h-5"
                                                                    />
                                                                    <span className={`font-semibold ${goal.completed ? 'line-through text-gray-500' : 'text-gray-800'}`}>
                                                                        {goal.goal}
                                                                    </span>
                                                                </div>
                                                                <div className="ml-7 text-sm text-gray-600">
                                                                    <div>Due: {goal.dueDate}</div>
                                                                    {goal.serviceStep && <div>Focus: {goal.serviceStep}</div>}
                                                                </div>
                                                                {goal.actionItems && goal.actionItems.length > 0 && (
                                                                    <div className="ml-7 mt-2">
                                                                        <div className="text-sm font-medium text-gray-700 mb-1">Action Items:</div>
                                                                        <ul className="text-sm text-gray-600 space-y-1">
                                                                            {goal.actionItems.map((item, i) => (
                                                                                <li key={i}>‚Ä¢ {item}</li>
                                                                            ))}
                                                                        </ul>
                                                                    </div>
                                                                )}
                                                            </div>
                                                            <button
                                                                onClick={() => {
                                                                    if (confirm('Delete this goal?')) {
                                                                        const updated = {...technicianGoals};
                                                                        updated[tech.name].splice(index, 1);
                                                                        setTechnicianGoals(updated);
                                                                        localStorage.setItem('technicianGoals', JSON.stringify(updated));
                                                                    }
                                                                }}
                                                                className="text-red-600 hover:text-red-800"
                                                            >
                                                                üóëÔ∏è
                                                            </button>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    );
                                })}
                                
                                {Object.keys(technicianGoals).length === 0 && (
                                    <div className="text-center py-12 text-gray-500">
                                        <div className="text-6xl mb-4">üéØ</div>
                                        <p className="text-lg">No goals set yet</p>
                                    </div>
                                )}
                                
                                {/* Goals Modal */}
                                {showGoalsModal && (
                                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                                        <div className="bg-white rounded-lg shadow-xl max-w-2xl w-full p-6">
                                            <h3 className="text-2xl font-bold text-gray-800 mb-4">Add New Goal</h3>
                                            <div className="space-y-4">
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">Technician *</label>
                                                    <select
                                                        id="goalTech"
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-md"
                                                    >
                                                        <option value="">Select technician</option>
                                                        {technicians.map(tech => (
                                                            <option key={tech.name} value={tech.name}>{tech.name} ({tech.dept})</option>
                                                        ))}
                                                    </select>
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">Goal *</label>
                                                    <input
                                                        type="text"
                                                        id="goalText"
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-md"
                                                        placeholder="e.g., Improve Present step to 4.5+"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">Service Step (Optional)</label>
                                                    <select id="goalStep" className="w-full px-3 py-2 border border-gray-300 rounded-md">
                                                        <option value="">General/Multiple Steps</option>
                                                        <option value="Prepare">Prepare</option>
                                                        <option value="Greet">Greet</option>
                                                        <option value="Explore">Explore</option>
                                                        <option value="Present">Present</option>
                                                        <option value="Execute">Execute</option>
                                                        <option value="Wrap Up">Wrap Up</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">Due Date *</label>
                                                    <select id="goalDueDate" className="w-full px-3 py-2 border border-gray-300 rounded-md">
                                                        <option value="30 days">30 days</option>
                                                        <option value="90 days">90 days</option>
                                                        <option value="6 months">6 months</option>
                                                        <option value="1 year">1 year</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">Action Items (one per line)</label>
                                                    <textarea
                                                        id="goalActions"
                                                        rows="4"
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-md"
                                                        placeholder="Shadow Eric on 3 calls&#10;Complete pricing training&#10;Practice presentations"
                                                    ></textarea>
                                                </div>
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => {
                                                            const techName = document.getElementById('goalTech').value;
                                                            const goalText = document.getElementById('goalText').value;
                                                            const step = document.getElementById('goalStep').value;
                                                            const dueDate = document.getElementById('goalDueDate').value;
                                                            const actions = document.getElementById('goalActions').value;
                                                            
                                                            if (!techName || !goalText) {
                                                                alert('Please select technician and enter goal');
                                                                return;
                                                            }
                                                            
                                                            const newGoal = {
                                                                goal: goalText,
                                                                serviceStep: step,
                                                                dueDate,
                                                                actionItems: actions.split('\n').filter(a => a.trim()),
                                                                createdDate: new Date().toISOString().split('T')[0],
                                                                completed: false
                                                            };
                                                            
                                                            const updated = {...technicianGoals};
                                                            if (!updated[techName]) updated[techName] = [];
                                                            updated[techName].push(newGoal);
                                                            
                                                            setTechnicianGoals(updated);
                                                            localStorage.setItem('technicianGoals', JSON.stringify(updated));
                                                            setShowGoalsModal(false);
                                                        }}
                                                        className="flex-1 bg-green-600 hover:bg-green-700 text-white font-semibold py-3 rounded-md"
                                                    >
                                                        Save Goal
                                                    </button>
                                                    <button
                                                        onClick={() => setShowGoalsModal(false)}
                                                        className="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-3 rounded-md"
                                                    >
                                                        Cancel
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };
        
        ReactDOM.render(<Dashboard />, document.getElementById('root'));
    </script>
</body>
</html>
